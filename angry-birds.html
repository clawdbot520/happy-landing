<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ†¤æ€’å°é³¥ - é–‹å¿ƒå°å¤©åœ° âœ¨</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .angry-game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .game-info {
            display: flex;
            gap: 30px;
            margin-bottom: 15px;
        }

        .game-info-item {
            padding: 10px 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .game-info-item span:first-child {
            font-size: 0.9rem;
            color: #888;
        }

        .game-info-item span:last-child {
            font-family: 'Comic Sans MS', cursive;
            font-size: 1.8rem;
            color: #FF6B35;
        }

        .game-canvas {
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: crosshair;
        }

        .game-controls {
            margin-top: 20px;
        }

        .restart-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #FF6B35, #FF8B5A);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .restart-btn:hover {
            transform: scale(1.05);
        }

        .instructions {
            margin-top: 20px;
            padding: 15px 25px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 15px;
            color: #666;
        }

        .instructions h4 {
            margin-bottom: 10px;
            color: #FF6B35;
        }

        .bird-hint {
            margin-top: 15px;
            padding: 12px 25px;
            background: linear-gradient(135deg, #FF6B35, #FF8B5A);
            color: white;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            animation: bounceHint 2s ease-in-out infinite;
        }

        @keyframes bounceHint {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <div class="ocean-bg">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
    </div>

    <div class="container">
        <header class="header">
            <a href="games.html" class="back-btn">â† å°éŠæˆ²å€</a>
            <h1 class="title">
                <span class="title-icon">ğŸ¦</span>
                æ†¤æ€’å°é³¥
                <span class="title-icon">ğŸ·</span>
            </h1>
        </header>

        <main class="content">
            <div class="angry-game-container">
                <!-- éŠæˆ²è³‡è¨Š -->
                <div class="game-info">
                    <div class="game-info-item">
                        <span>ğŸ¯ åˆ†æ•¸</span>
                        <span id="score">0</span>
                    </div>
                    <div class="game-info-item">
                        <span>ğŸ· å‰©ä¸‹</span>
                        <span id="pigs-left">3</span>
                    </div>
                </div>

                <!-- éŠæˆ²ç•«å¸ƒ -->
                <canvas id="gameCanvas" class="game-canvas" width="900" height="500"></canvas>

                <!-- å°é³¥æç¤º -->
                <div id="bird-hint" class="bird-hint">
                    ğŸ¦ å°é³¥åœ¨å·¦é‚Šï¼æ‹–ä½å¾€å¾Œæ‹‰ï½â¬…ï¸
                </div>

                <!-- æ§åˆ¶æŒ‰éˆ• -->
                <div class="game-controls">
                    <button class="restart-btn" onclick="restartGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
                </div>

                <!-- èªªæ˜ -->
                <div class="instructions">
                    <h4>ğŸ® éŠæˆ²èªªæ˜</h4>
                    <p>æ‹–ä½å°é³¥å¾€å¾Œæ‹‰ï¼Œç„æº–å¾Œæ”¾é–‹æŠŠå°è±¬æ‰“ä¸‹ä¾†ï¼</p>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>æ‰“æ•—æ‰€æœ‰å°è±¬ï¼ğŸ·ğŸ’¥</p>
        </footer>
    </div>

    <script>
        // éŠæˆ²è®Šæ•¸
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let score = 0;
        let isDragging = false;
        let gameWon = false;
        let birdReleased = false;

        // å½ˆå¼“ä½ç½®
        const slingshot = {
            x: 120,
            y: 380,
            width: 20,
            height: 100
        };

        // å°é³¥
        let bird = {
            x: slingshot.x,
            y: slingshot.y,
            radius: 25,
            vx: 0,
            vy: 0,
            gravity: 0.4,
            elasticity: 0.6,
            isFlying: false,
            inSlingshot: true,
            startX: slingshot.x,
            startY: slingshot.y
        };

        // å°è±¬é™£åˆ—
        let pigs = [];
        let structures = [];

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            score = 0;
            gameWon = false;
            birdReleased = false;
            bird = {
                x: slingshot.x,
                y: slingshot.y,
                radius: 25,
                vx: 0,
                vy: 0,
                gravity: 0.4,
                elasticity: 0.6,
                isFlying: false,
                inSlingshot: true,
                startX: slingshot.x,
                startY: slingshot.y
            };

            // å‰µå»ºå°è±¬
            pigs = [
                { x: 700, y: 400, radius: 30, alive: true, vx: 0, vy: 0 },
                { x: 780, y: 350, radius: 25, alive: true, vx: 0, vy: 0 },
                { x: 730, y: 280, radius: 22, alive: true, vx: 0, vy: 0 }
            ];

            // å‰µå»ºå»ºç¯‰çµæ§‹ï¼ˆæœ¨å¡Šï¼‰
            structures = [
                { x: 650, y: 420, width: 20, height: 80, type: 'wood', hp: 3 },
                { x: 750, y: 420, width: 20, height: 80, type: 'wood', hp: 3 },
                { x: 700, y: 350, width: 120, height: 15, type: 'wood', hp: 3 },
                { x: 760, y: 300, width: 15, height: 60, type: 'wood', hp: 2 }
            ];

            updateUI();
        }

        // æ›´æ–° UI
        function updateUI() {
            document.getElementById('score').textContent = score;
            const pigsLeft = pigs.filter(p => p.alive).length;
            document.getElementById('pigs-left').textContent = pigsLeft;

            if (pigsLeft === 0 && !gameWon) {
                gameWon = true;
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œéé—œï¼\n\nå¾—åˆ†ï¼š' + score + '\n\n' + getEncouragement(score));
                }, 500);
            }
        }

        function getEncouragement(score) {
            if (score >= 300) return 'ğŸŒŸ å¤ªå²å®³äº†ï¼ä½ æ˜¯æ†¤æ€’å°é³¥é«˜æ‰‹ï¼';
            if (score >= 200) return 'ğŸ‘ è¡¨ç¾å¾ˆæ£’ï¼ç¹¼çºŒåŠ æ²¹ï¼';
            if (score >= 100) return 'ğŸ˜Š ä¸éŒ¯å–”ï¼å¤šç·´ç¿’æœƒæ›´å¥½ï¼';
            return 'ğŸ’ª å†æ¥å†å²ï¼ä¸‹ä¸€æ¬¡æœƒæ›´å¥½ï¼';
        }

        // ç•«åœ–
        function draw() {
            // å¤©ç©ºæ¼¸è®Š
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#E0F7FA');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç•«é›²æœµ
            drawCloud(100, 80, 60);
            drawCloud(300, 50, 45);
            drawCloud(600, 90, 55);
            drawCloud(800, 60, 40);

            // ç•«è‰åœ°
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, 450, canvas.width, 50);
            ctx.fillStyle = '#7CCD7C';
            ctx.fillRect(0, 455, canvas.width, 5);

            // ç•«å°é³¥ï¼ˆåœ¨å½ˆå¼“å‰é¢ï¼‰
            drawBird();

            // ç•«å½ˆå¼“
            drawSlingshot();

            // ç•«å»ºç¯‰çµæ§‹
            structures.forEach(s => drawStructure(s));

            // ç•«å°è±¬
            pigs.forEach(p => {
                if (p.alive) drawPig(p);
            });

            // ç•«æ‹–æ›³ç·šï¼ˆå¦‚æœåœ¨æ‹–æ›³ï¼‰
            if (isDragging && bird.inSlingshot) {
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(slingshot.x, slingshot.y);
                ctx.lineTo(bird.x, bird.y);
                ctx.stroke();
            }

            requestAnimationFrame(draw);
        }

        function drawCloud(x, y, size) {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.arc(x + size * 0.8, y - size * 0.2, size * 0.7, 0, Math.PI * 2);
            ctx.arc(x + size * 1.4, y, size * 0.8, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawSlingshot() {
            // Yå½¢å½ˆå¼“
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 12;
            ctx.lineCap = 'round';

            // ä¸»å¹¹
            ctx.beginPath();
            ctx.moveTo(slingshot.x, slingshot.y + 50);
            ctx.lineTo(slingshot.x, slingshot.y - 20);
            ctx.stroke();

            // å·¦å‰
            ctx.beginPath();
            ctx.moveTo(slingshot.x, slingshot.y - 20);
            ctx.lineTo(slingshot.x - 25, slingshot.y - 50);
            ctx.stroke();

            // å³å‰
            ctx.beginPath();
            ctx.moveTo(slingshot.x, slingshot.y - 20);
            ctx.lineTo(slingshot.x + 25, slingshot.y - 50);
            ctx.stroke();
        }

        function drawBird() {
            ctx.save();

            // èº«é«”
            ctx.fillStyle = '#FF6B35';
            ctx.beginPath();
            ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI * 2);
            ctx.fill();

            // è‚šå­
            ctx.fillStyle = '#FFE4B5';
            ctx.beginPath();
            ctx.arc(bird.x + 5, bird.y + 5, bird.radius * 0.6, 0, Math.PI * 2);
            ctx.fill();

            // çœ¼ç›
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(bird.x + 8, bird.y - 8, 10, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(bird.x + 12, bird.y - 8, 5, 0, Math.PI * 2);
            ctx.fill();

            // çœ‰æ¯›ï¼ˆæ†¤æ€’è¡¨æƒ…ï¼‰
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(bird.x - 2, bird.y - 18);
            ctx.lineTo(bird.x + 15, bird.y - 12);
            ctx.stroke();

            // å˜´å·´
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.moveTo(bird.x + 20, bird.y);
            ctx.lineTo(bird.x + 35, bird.y + 5);
            ctx.lineTo(bird.x + 20, bird.y + 8);
            ctx.fill();

            ctx.restore();
        }

        function drawPig(pig) {
            ctx.save();

            // èº«é«”
            ctx.fillStyle = '#90EE90';
            ctx.beginPath();
            ctx.arc(pig.x, pig.y, pig.radius, 0, Math.PI * 2);
            ctx.fill();

            // é¼»å­
            ctx.fillStyle = '#7CCD7C';
            ctx.beginPath();
            ctx.ellipse(pig.x, pig.y + 5, pig.radius * 0.5, pig.radius * 0.4, 0, 0, Math.PI * 2);
            ctx.fill();

            // é¼»å­”
            ctx.fillStyle = '#5CB85C';
            ctx.beginPath();
            ctx.arc(pig.x - 6, pig.y + 5, 4, 0, Math.PI * 2);
            ctx.arc(pig.x + 6, pig.y + 5, 4, 0, Math.PI * 2);
            ctx.fill();

            // çœ¼ç›
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(pig.x - 10, pig.y - 10, 8, 0, Math.PI * 2);
            ctx.arc(pig.x + 10, pig.y - 10, 8, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(pig.x - 8, pig.y - 10, 4, 0, Math.PI * 2);
            ctx.arc(pig.x + 12, pig.y - 10, 4, 0, Math.PI * 2);
            ctx.fill();

            // è€³æœµ
            ctx.fillStyle = '#90EE90';
            ctx.beginPath();
            ctx.ellipse(pig.x - 20, pig.y - 20, 8, 12, -0.3, 0, Math.PI * 2);
            ctx.ellipse(pig.x + 20, pig.y - 20, 8, 12, 0.3, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        function drawStructure(s) {
            ctx.save();

            if (s.type === 'wood') {
                const alpha = 0.3 + (s.hp / 3) * 0.7;
                ctx.fillStyle = `rgba(139, 69, 19, ${alpha})`;
            }

            ctx.fillRect(s.x, s.y, s.width, s.height);
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 2;
            ctx.strokeRect(s.x, s.y, s.width, s.height);

            ctx.restore();
        }

        // ç‰©ç†æ›´æ–°
        function update() {
            if (bird.isFlying) {
                // é‡åŠ›
                bird.vy += bird.gravity;
                bird.x += bird.vx;
                bird.y += bird.vy;

                // é‚Šç•Œç¢°æ’
                if (bird.x < bird.radius || bird.x > canvas.width - bird.radius) {
                    bird.vx *= -0.5;
                    bird.x = Math.max(bird.radius, Math.min(canvas.width - bird.radius, bird.x));
                }
                if (bird.y > canvas.height - 50) {
                    bird.vy *= -0.5;
                    bird.y = canvas.height - 55;
                    bird.vx *= 0.8;

                    // åœæ­¢
                    if (Math.abs(bird.vx) < 0.5 && Math.abs(bird.vy) < 0.5) {
                        bird.isFlying = false;
                        setTimeout(() => {
                            if (!gameWon) resetBird();
                        }, 1000);
                    }
                }
            }

            // å°è±¬ç‰©ç†
            pigs.forEach(pig => {
                if (pig.alive) {
                    pig.vy += 0.5;
                    pig.x += pig.vx;
                    pig.y += pig.vy;
                    pig.vx *= 0.95;

                    // åœ°é¢ç¢°æ’
                    if (pig.y > 450 - pig.radius) {
                        pig.y = 450 - pig.radius;
                        pig.vy *= -0.3;
                        pig.vx *= 0.8;
                    }

                    // çµæ§‹ç¢°æ’
                    structures.forEach(s => {
                        if (pig.x + pig.radius > s.x && pig.x - pig.radius < s.x + s.width &&
                            pig.y + pig.radius > s.y && pig.y - pig.radius < s.y + s.height) {
                            // ç°¡å–®çš„ç¢°æ’éŸ¿æ‡‰
                            pig.vx *= -0.5;
                            pig.vy *= -0.3;
                        }
                    });

                    // æª¢æŸ¥è¢«é³¥æ‰“åˆ°
                    if (bird.isFlying) {
                        const dx = bird.x - pig.x;
                        const dy = bird.y - pig.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        if (dist < bird.radius + pig.radius + 10) {
                            pig.alive = false;
                            bird.vx *= 0.5;
                            bird.vy *= 0.3;
                            score += 100;
                            updateUI();

                            // å°è±¬é£›å‡ºå»
                            pig.vx = bird.vx * 0.8;
                            pig.vy = bird.vy * 0.8 - 5;
                        }
                    }
                } else {
                    // æ­»äº¡çš„å°è±¬é£›è¡Œ
                    pig.vy += 0.5;
                    pig.x += pig.vx;
                    pig.y += pig.vy;
                }
            });

            requestAnimationFrame(update);
        }

        // æ»‘é¼ äº‹ä»¶
        canvas.addEventListener('mousedown', (e) => {
            if (bird.inSlingshot) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const dx = x - bird.x;
                const dy = y - bird.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < bird.radius + 20) {
                    isDragging = true;
                }
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging && bird.inSlingshot) {
                const rect = canvas.getBoundingClientRect();
                let x = e.clientX - rect.left;
                let y = e.clientY - rect.top;

                // é™åˆ¶æ‹–æ›³ç¯„åœ
                const maxDrag = 100;
                const dx = x - slingshot.x;
                const dy = y - slingshot.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist > maxDrag) {
                    x = slingshot.x + dx * maxDrag / dist;
                    y = slingshot.y + dy * maxDrag / dist;
                }

                // åªå…è¨±å¾€å¾Œæ‹‰ï¼ˆå·¦å¾Œæ–¹ï¼‰
                if (x > slingshot.x + 20) {
                    x = slingshot.x + 20;
                }

                bird.x = x;
                bird.y = y;
            }
        });

        canvas.addEventListener('mouseup', () => {
            if (isDragging && bird.inSlingshot) {
                isDragging = false;

                // è¨ˆç®—ç™¼å°„é€Ÿåº¦
                const dx = slingshot.x - bird.x;
                const dy = slingshot.y - bird.y;

                // æœ€å°ç™¼å°„é€Ÿåº¦
                if (dx > 10 || Math.abs(dy) > 10) {
                    bird.vx = dx * 0.15;
                    bird.vy = dy * 0.15;
                    bird.isFlying = true;
                    bird.inSlingshot = false;
                    birdReleased = true;
                } else {
                    // é‡ç½®ä½ç½®
                    bird.x = slingshot.x;
                    bird.y = slingshot.y;
                }
            }
        });

        // è§¸æ§æ”¯æ´
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            canvas.dispatchEvent(new MouseEvent('mouseup'));
        });

        function resetBird() {
            if (!gameWon) {
                bird.x = slingshot.x;
                bird.y = slingshot.y;
                bird.vx = 0;
                bird.vy = 0;
                bird.isFlying = false;
                bird.inSlingshot = true;
                birdReleased = false;
            }
        }

        function restartGame() {
            initGame();
        }

        // å•Ÿå‹•éŠæˆ²
        initGame();
        draw();
        update();
    </script>
</body>
</html>
